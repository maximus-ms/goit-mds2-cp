# **Тиждень 3. Щотижневий звіт про прогрес виконання дипломної роботи**

**Тема:** Система інтелектуальної діагностики технічних пристроїв на основі акустичних сигналів з використанням методів машинного навчання

## 1. Опис виконаних завдань та прогрес (MVP Phase 2)

Цей тиждень був присвячений підготовці фундаменту для моделювання: роботі з даними та поглибленню експертизи в обробці аудіосигналів.

* **Корекція методології:** Відповідно до попередніх обговорень (спрощення апаратної частини), було остаточно затверджено перехід до роботи з двома мікрофонами як мінімальним робочим прототипом. Це дозволило сфокусувати аналіз даних саме на стерео-конфігураціях.

* **Пошук датасету (Data Acquisition):**
    * Знайдено датасет **MIMII (Malfunctioning Industrial Machine Investigation and Inspection)**, який підходить для нашого випадку використання.
    * Датасет містить багатоканальні аудіозаписи промислових машин (fan, pump, slider, valve) у нормальному та аномальному станах з різними рівнями SNR (6dB, 0dB, -6dB).
    * Додано інформацію про датасет у документацію проєкту (`docs/DCASE2019Workshop_Purohit_21.pdf`).

* **Теоретичні дослідження:**
    * Знайдено інформацію про способи роботи зі звуком в Machine Learning.
    * Прослухано два курси лекцій на YouTube:
        * [Deep Learning (for Audio) with Python](https://youtu.be/fMqL5vckiU0?list=PL-wATfeyAMNrtbkCNsLcpoAyBBRJZVlnf) — серія лекцій про теорію та реалізацію deep learning для аудіо та музики з використанням TensorFlow
        * [Audio Signal Processing for Machine Learning](https://youtu.be/iCwMQJnKk2c?list=PL-wATfeyAMNqIee7cH3q1bh4QJFAaeNv0) — курс про ключові концепції обробки аудіосигналів для ML-додатків

* **Аналіз даних (Exploratory Data Analysis):**
    * Проаналізовано датасет MIMII, його структуру, кількість даних, відповідність проєкту.
    * Підтверджено релевантність датасету для задачі детекції аномалій у промислових механізмах.
    * Проаналізовано кількість семплів, частоту дискретизації (16 кГц), розподіл типів машин та рівнів SNR у датасеті MIMII.

* **Розробка Software (Data Preprocessing Pipeline):**
    * Створено мінімальний код для аналізу та перегляду датасету в Jupyter Notebook (`project/sandbox.ipynb`).
    * Розроблено скрипт `project/host/tools/process_mimii.py` для обробки датасету, що включає:
        * Завантаження багатоканальних WAV файлів у пам'ять за допомогою бібліотеки `soundfile`
        * Виділення та агрегацію важливих каналів для кожного типу машини:
            * `fan`: канали 3, 5
            * `pump`: канали 1, 3
            * `slider`: канали 5, 7
            * `valve`: канали 1, 7
        * Мікшування вибраних каналів для отримання стерео-сигналу (середнє арифметичне)
        * Конвертацію у формат int16 для економії пам'яті (множення на 32767 та приведення до `torch.int16`)
        * Збереження всієї інформації у словник списків для зручного доступу під час навчання: `{machine_type: {machine_id: {snr: [tensors]}}}`
        * Серіалізацію оброблених даних у єдиний бінарний файл PyTorch (`.pt`) для прискорення подальшого завантаження (IO optimization)

## 2. Результати аналізу та розробки

В рамках роботи з датасетом було протестовано наскрізний пайплайн обробки даних (WAV файли → завантаження → вибір каналів → мікшування → серіалізація → PyTorch tensor).

**Ключові результати:**
1.  **Структура датасету:** Підтверджено релевантність датасету MIMII для задачі детекції аномалій у промислових механізмах. Датасет містить достатню кількість семплів для навчання моделей.
2.  **Оптимізація пам'яті:** Впроваджено етап попередньої агрегації та вибору лише критично важливих каналів (відповідно до схеми з 2 мікрофонами), що дозволило оптимізувати розмір бінарного файлу та прискорити завантаження даних під час навчання.

**Технічні рішення:**
* Використано PyTorch для роботи з тензорами та серіалізації даних
* Реалізовано автоматичне визначення типів машин та їх ID на основі структури директорій
* Додано обробку помилок для коректної роботи з великими обсягами даних
* Створено CLI інтерфейс з підтримкою аргументів командного рядка для гнучкої конфігурації

## 3. Ризики, виклики та їх вирішення

Основні труднощі тижня були пов'язані з обробкою великих обсягів аудіоданих та оптимізацією пам'яті.

* **Проблема 1:** Великий обсяг сирих аудіоданих сповнює пам'ять.
    * *Причина:* Датасет MIMII містить багатоканальні WAV файли (8 каналів), що при завантаженні всіх каналів займають значний обсяг оперативної пам'яті (більше 40 ГБ кожного рівня SNR). Для навчання моделей потрібна лише сума двох каналів, що відповідають розташуванню пристрою підчас запису.
    * *Рішення:* Впроваджено етап попередньої агрегації та вибору лише критично важливих каналів для кожного типу машини. Це дозволило:
        * Зменшити обсяг даних у ~8 разів (з 8 каналів до суми двох, а отже до 1 агрегованого каналу)
        * Оптимізувати розмір бінарного файлу
        * Прискорити завантаження даних під час навчання моделей

* **Проблема 2:** Складність синхронізації фаз у звукових доріжках та вибір формату представлення даних для ML-моделей.
    * *Причина:* Сирі аудіодані у форматі waveform потребують додаткової обробки для виявлення паттернів. Потрібно визначитися з форматом вхідних даних для нейромережі (waveform, спектрограми, MFCC тощо).
    * *Рішення:* Після прослуховування лекцій з обробки аудіосигналів було вирішено використовувати MEL-спектрограми як вхідні дані для CNN. На поточному етапі дані зберігаються у форматі waveform для гнучкості подальшої обробки.

* **Проблема 3:** Необхідність конвертації формату даних для економії пам'яті.
    * *Причина:* Дані з WAV файлів завантажуються у форматі float32, що займає 4 байти на семпл. Для великих обсягів даних це призводить до надмірного використання пам'яті.
    * *Рішення:* Реалізовано конвертацію у формат int16:
        * Множення на 32767 для збереження амплітуди сигналу
        * Приведення до `torch.int16` для зменшення розміру у 2 рази (з 4 байт до 2 байт на семпл)
        * Збереження коректного діапазону значень [-32768, 32767]

## 4. План роботи на наступний тиждень (Тиждень 4)

Фокус зміщується з підготовки даних на розробку ML-моделей та їх навчання.

1.  **Архітектура моделі:** Розробити архітектуру мінімальної CNN моделі (baseline) для детекції аномалій на основі MEL-спектрограм.
2.  **Підготовка до навчання:** Створити DataLoader для завантаження оброблених даних з `.pt` файлу та підготовка до навчання моделі. DataLoader має випадково обирати 1 секундний відрізок з 10 секундного семплу, формувати MEL-спектрограму для цього відрізка та повертати готові дані для навчання моделі.
3.  **Перше навчання:** Провести навчання baseline моделі на невеликій вибірці даних та отримати перші графіки лосу (loss).
4.  **Демо:** Підготувати демонстрацію роботи скрипта з перетворення аудіо в спектрограми та структури підготовленого бінарного датасету.

## 5. Артефакти

* **GitHub Репозиторій:** Структура проєкту доповнена наступними файлами:
    * `project/host/tools/process_mimii.py` — Python-скрипт для обробки датасету MIMII (завантаження, агрегація каналів, серіалізація у PyTorch формат)
    * `project/sandbox.ipynb` — Jupyter Notebook для аналізу та візуалізації даних датасету MIMII

* **Дані:** Оброблений файл датасету у форматі PyTorch (`.pt` файл з вкладеною структурою: `{machine_type: {machine_id: {snr: [tensors]}}}`). Файл розміром 13 ГБ зберігається локально та не додається до репозиторію. Для відтворення результату достатньо запустити скрипт `process_mimii.py` з вхідним датасетом MIMII.

* **Документація:**
    * `docs/DCASE2019Workshop_Purohit_21.pdf` — наукова стаття про датасет MIMII та методи детекції аномалій у промислових механізмах
